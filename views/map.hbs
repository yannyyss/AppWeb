<style>
  .input_none{
    display: none;  
  }
  .pac-container {
    z-index: 99888999 !important;
  }
</style>
<nav class="navbar navbar-dark bg-dark navbar-nav navbar-expand-sm navbar-expand-sm-lg">
  <div class="form">
    <button class="navbar-toggler " type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/profile">Perfil</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout">Salir</a>
        </li>
      </ul>
    </div>
    <form class="form">
      <input class="form-control" type="search" placeholder="Search" id="address">
      <button type="button" class="btn bg-dark" data-toggle="modal" data-target="#exampleModal" id="malandro">
        <img src="images/boton-superior-malandro-2.png" width="40" height="40" alt="malandro" >
      </button>
    </form>
  </div>
</nav>

<div id="map"></div>
<footer>
  <nav class="footer-nav">
    <a class="iconimages" href="#">
      <img src="images/icono-robo.png" width="140" height="140" alt="">
    </a>
    <a class="iconimages" href="#">
      <img src="images/icono-acoso-sexual.png" width="140" height="140" alt="">
    </a>
    <a class="iconimages" href="#">
      <img src="images/icono-grupos-sospechosos.png" width="140" height="140" alt="">
    </a>
    <a class="iconimages" href="#">
      <img src="images/icono-enfrentamientos-armados.png" width="140" height="140" alt="">
    </a>
    <a class="iconimages" href="#">
      <img src="images/icono-sin-luz.png" width="140" height="140" alt="">
    </a>
    <a class="iconimages" href="#">
      <img src="images/icono-agresion.png" width="140" height="140" alt="">
    </a>
  </nav>
</footer>


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Este lugar, Está Malandro</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="/places/new" method="post">
          <div class="form-group">
            <select name="tipodelugar" id="tipodelugar" class="form-control">
              <option selected>Tipo de Incidente</option>
              <option value="Robo">Robo</option>
              <option value="Acoso Sexual">Acoso Sexual</option>
              <option value="Grupos Sospechosos">Grupos Sospechosos</option>
              <option value="Enfrentamientos Armados">Enfrentamientos Armados</option>
              <option value="Sin Iluminación">Sin Iluminación</option>
              <option value="Agresión">Agresión</option>
            </select>
          </div> 
          <div class="form-group row">
            <div class="col-sm-12">
              <input type="text" class="form-control" id="direccion" placeholder="Dirección" name="location[address]">
              <input type="text" name="location[coordinates][1]" id="lat" class="input_none">
              <input type="text" name="location[coordinates][0]" id="lng" class="input_none">
            </div>  

          </div>
          <div class="form-group row">
            <div class="col-sm-12">
              <textarea type="text" class="form-control" id="comentario" placeholder="Comentario" name="comentario"></textarea>
            </div>  
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">Reportar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAGQ8r0BfjX69HJHYdnGnoZ5K1m9YwjcQo&libraries=places"></script>
  <script>

    /* New Dot */


    const search = document.getElementById('address');
    const malandro = document.getElementById('malandro');
    const image = {
      url:'images/marcador-malandro-rojo-small.png',
      size: new google.maps.Size(59, 80)
    };
    const options = {
      componentRestrictions: {country: 'mx'}
    };

    let direccion = document.getElementById('direccion');
    let lat = document.getElementById('lat');
    let lng = document.getElementById('lng');

    function autoComplete(input) {
      console.log('hola')
      const dropdown = new google.maps.places.Autocomplete(input, options);
      dropdown.addListener('place_changed', () => {
        console.log('hola');
        const place = dropdown.getPlace();
        direccion.value = input.value;
        lat.value = place.geometry.location.lat();
        lng.value = place.geometry.location.lng();
        nuevaDireccion(place)
      });

    }

    function nuevaDireccion (place){

      const lugar = place;
      const center = {
        lat: lugar.geometry.location.lat(),
        lng: lugar.geometry.location.lng()
      };
      const map = new google.maps.Map(
        document.getElementById('map'),
        {
          zoom: 19,
          center: center
        }
      )
      const myMarker = new google.maps.Marker({
        position: center,
        map: map,
        title: "I'm here",
        animation: google.maps.Animation.BOUNCE,
        icon: image
      });
    }

    malandro.addEventListener('click',autoComplete(direccion));

    function startMap() {

      if (navigator.geolocation) {
        // Get current position
        // The permissions dialog will popup
        navigator.geolocation.getCurrentPosition(function (position) {
          const center = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          // Create an object to match
          // google's Lat-Lng object format
          const map = new google.maps.Map(
            document.getElementById('map'),
            {
              center,
              zoom: 19
            }
          );


          const myMarker = new google.maps.Marker({
            position: center,
            map: map,
            title: "I'm here",
            animation: google.maps.Animation.BOUNCE,
            icon: image
          });

          // User granted permission
          // Center the map in the position we got
        }, function () {
          // If something else goes wrong
          console.log('Error in the geolocation service.');
        });
      } else {
        // Browser says: Nah! I do not support this.
        console.log('Browser does not support geolocation.');
      }
    }

    startMap();
    // autoComplete(search);

    malandro.addEventListener('click', autoComplete(direccion))
  </script>
